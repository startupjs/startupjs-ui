import { useState } from 'react'
import { $, useSub } from 'startupjs'
import FileInput, { _PropsJsonSchema as FileInputPropsJsonSchema } from './index'
import Div from '@startupjs-ui/div'
import Avatar from '@startupjs-ui/avatar'
import Span from '@startupjs-ui/span'
import { Sandbox } from '@startupjs-ui/docs'

# FileInput

FileInput lets users pick a file (or image) and upload it to your StartupJS backend. The `value` is a `fileId` pointing to a document in the `files` model.

```jsx
import { FileInput } from 'startupjs-ui'
```

## Basic usage

```jsx example
const [fileId, setFileId] = useState()
return (
  <FileInput
    value={fileId}
    onChange={setFileId}
  />
)
```

## Image picker

```jsx
const $avatarFileId = $()
const $file = useSub($.files[$avatarFileId.get() ?? '__DUMMY__'])
return (
  <Div gap>
    <Span>Your avatar:</Span>
    {
      $avatarFileId.get()
        ? <Avatar src={$file.getUrl() + '?' + $file.updatedAt.get()}>{name}</Avatar>
        : <Span italic>No avatar uploaded</Span>
    }
    <FileInput
      image
      value={$avatarFileId.get()}
      onChange={fileId => $avatarFileId.set(fileId)}
    />
  </Div>
)
```

**Note:** the trick with appending `?` and `updatedAt` timestamp to the URL is optional. It might be needed in some cases (like on the page of changing the profile picture of a user) to force reloading the image after it has been changed, otherwise the cached version may be shown in the browser.

## Storage providers

FileInput supports multiple storage backends. By default it uses SQLite, but if `MONGO_URL` is configured (MongoDB is used by StartupJS), the default storage becomes MongoDB (GridFS). You can force a specific provider with `DEFAULT_STORAGE_TYPE`.

### SQLite (default)

- Default when no `MONGO_URL` is configured.
- Force with `DEFAULT_STORAGE_TYPE=sqlite`.

### MongoDB (GridFS)

- Default when `MONGO_URL` is configured.
- Force with `DEFAULT_STORAGE_TYPE=mongo`.

### Azure Blob Storage

- Force with `DEFAULT_STORAGE_TYPE=azureblob`.
- Requires `AZURE_BLOB_STORAGE_CONNECTION_STRING`.
- Install the Azure SDK: `yarn add @azure/storage-blob`.

## Sandbox

<Sandbox
  Component={FileInput}
  propsJsonSchema={FileInputPropsJsonSchema}
  props={{
    onChange: fileId => alert('Uploaded fileId: ' + fileId)
  }}
  block
/>
